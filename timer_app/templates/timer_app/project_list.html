{% extends "timer_app/base.html" %}
{% load timer_filters %}

{% block title %}All Projects - Timer Tracker{% endblock %}

{% block breadcrumb %}
<div class="breadcrumb">
    <a href="{% url 'home' %}">Home</a>
    <span>â€º</span>
    <span>All Projects</span>
</div>
{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">All Projects</h1>
</div>

{% if projects %}
<div class="filter-controls">
    <div class="search-box">
        <input type="text" id="projectSearch" class="form-input" placeholder="ðŸ” Search projects...">
    </div>
    <div class="toggle-controls">
        <label class="toggle-label">
            <input type="checkbox" id="showCompleted" checked>
            <span>Show completed projects</span>
        </label>
    </div>
</div>

<div class="card">
    <table class="table">
        <thead>
            <tr>
                <th>Project Name</th>
                <th>Customer</th>
                <th>Status</th>
                <th>Timers</th>
                <th>Total Time</th>
                <th>Total Cost</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for project in projects %}
            <tr class="project-row" data-status="{{ project.status }}" data-name="{{ project.name|lower }}" data-customer="{{ project.customer.name|lower }}">
                <td><a href="{% url 'project_detail' project.pk %}">{{ project.name }}</a></td>
                <td><a href="{% url 'customer_detail' project.customer.pk %}">{{ project.customer.name }}</a></td>
                <td>
                    <span class="status-badge status-{{ project.status }}">
                        {{ project.get_status_display }}
                    </span>
                </td>
                <td>{{ project.timers.count }}</td>
                <td>{{ project.total_duration_seconds|format_duration }}</td>
                <td>{{ project.total_cost|format_currency }}</td>
                <td class="actions">
                    <a href="{% url 'project_detail' project.pk %}" class="btn btn-small">View</a>
                    <a href="{% url 'project_edit' project.pk %}" class="btn btn-small btn-secondary">Edit</a>
                    <a href="{% url 'project_delete' project.pk %}" class="btn btn-small btn-danger">Delete</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="card">
    <p>No projects yet. <a href="{% url 'customer_list' %}">Go to customers</a> to add projects.</p>
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
    // Search projects
    const projectSearch = document.getElementById('projectSearch');
    if (projectSearch) {
        projectSearch.addEventListener('input', function(e) {
            filterProjects();
        });
    }

    // Toggle completed projects
    const showCompleted = document.getElementById('showCompleted');
    if (showCompleted) {
        showCompleted.addEventListener('change', function() {
            filterProjects();
        });
    }

    function filterProjects() {
        const searchTerm = projectSearch ? projectSearch.value.toLowerCase() : '';
        const showCompletedProjects = showCompleted ? showCompleted.checked : true;
        const rows = document.querySelectorAll('.project-row');
        
        rows.forEach(row => {
            const projectName = row.dataset.name;
            const customerName = row.dataset.customer;
            const projectStatus = row.dataset.status;
            
            const matchesSearch = projectName.includes(searchTerm) || customerName.includes(searchTerm);
            const matchesStatus = showCompletedProjects || projectStatus !== 'completed';
            
            if (matchesSearch && matchesStatus) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    }
</script>
{% endblock %}

